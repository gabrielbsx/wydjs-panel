<script>
    //Author: Kentaro
    /*
    var pages = [
        'home', 'donate', 'donate-rules', 'ranking-players', 'ranking-cities', 'guildmark', 'change-password', 'recovery-numeric-password',
    ];

    var translate = {
        'id': 'Identificador',
        'name': 'Nome',
        'player': 'Jogador',
        'percent': 'Porcentagem',
        'donate': 'Donate',
        'value': 'Valor',
        'createdAt': 'Criado em',
        'updatedAt': 'Atualizado em',
    };

    var removeHomeClass = !(location.hash === '#home' || location.hash === '');
    
    if (!location.hash.length) {
        $('a[href*="#home"]').parent().addClass('active');
        $('.home').show('slow');
        var currentElement = $('li.active').children('a');
    } else {
        var elem = $(`a[href*="${location.hash}"]:first`);
        elem = elem.parent().parent().parent().parent().is('li') ? elem.parent().parent().parent().parent() : elem.parent();
        elem.addClass('active');
        $(location.hash.replace('#', '.')).show('slow');
        var currentElement = elem;
    }

    async function updateApi(url, id, data) {
        $('.update-data').text('');
        $('.update-title').text(url.replaceAll('-', ' ').replace('/', ''));
        $.ajax({
            url: url,
            data: {
                id: id,
            },
            success: async (data) => {
                var data = data.data;
                if (typeof data !== 'undefined') {
                    var form = `<forms method="POST" action="/update-${url.replace('/', '')}">`;
                    
                    data.forEach(async (value, key) => {
                        Object.keys(value).forEach(async (name) => {
                            if (['createdAt', 'updatedAt'].includes(name)) return;
                            form += `
                                <div class="form-group my-1">
                                    <input class="form-control" type="${name === 'id' ? 'hidden' : 'text'}" name="${name}" value="${value[name]}">
                                </div>
                            `;
                        });                 
                    });
                    form += `
                        <input type="hidden" class="form-control g-recaptcha-response" name="g-recaptcha-response">
                        <input type="hidden" class="form-control" name="action" value="validate_captcha">
                    `;
                    form += '<button id="submit" onclick="clickupdel(this, \'update-'+url+'\');" type="submit" class="btn btn-primary">Atualizar</button>';
                    form += `</forms>`;
                    $('.update-data').append(form);
                }
            },
            error: async (err) => {
                $(".message-ajax").append(`
                    <div class="alert alert-${message.status === 'success' ? message.status : 'danger'}">
                        ${message.message}
                    </div>
                `);
                $(".message-ajax").show('slow');
                setTimeout(async () => {
                    $(".message-ajax").hide('slow');
                }, 3000);
                setTimeout(async () => {
                    $(".message-ajax").empty();
                }, 3300);
            },
        });
        await setrecaptcha();
        $('.update').toggle('slow');

        $('.update-data').append(``);
    }

    async function clickupdel(button, url) {
        var inputs = $(button).parents('forms').find(':input');
        const method = $(button).parents('forms').attr('method');
        var data = {};
        url = '/' + url.replace('/', '');
        inputs.each((key, value) => {
            if (value.className === 'form-control' || value.className === 'g-recaptcha-response' || value.className === 'form-control g-recaptcha-response') {
                var n = $(value).attr('name');
                var v = $(value).attr('value');
                data[n] = v;
            }
        });
        console.log(data);
        $.ajax({
            url: url,
            method: method,
            data: data,
            success: async (message) => {
                console.log(message);
            },
            error: async (err) => {
                $(".message-ajax").append(`
                    <div class="alert alert-${message.status === 'success' ? message.status : 'danger'}">
                        ${message.message}
                    </div>
                `);
                $(".message-ajax").show('slow');
                setTimeout(async () => {
                    $(".message-ajax").hide('slow');
                }, 3000);
                setTimeout(async () => {
                    $(".message-ajax").empty();
                }, 3300);
            },
        });
        return;
    }
    
    async function deleteApi(url, id) {
        console.log(id);
    }

    async function addGuildname(guildname, guildid) {
        
    }
    
    async function getGuildname(id) {
        
    }
    
    async function verifyGuild() {
        $.get("/guildinfo", (data) => {
            console.log(data);
        });
    }
    
    async function setpage(page, element) {
        var button = $(element).parent().parent().parent().parent();
        button = button.is('li') ? button : $(element).parent();

        if (currentElement) {
            $(currentElement).removeClass('active');
            var oldButton = $(currentElement).parent().parent().parent().parent();
            oldButton = oldButton.is('li') ? oldButton : $(currentElement).parent();
            oldButton.removeClass('active');
            button.addClass('active');
        }

        if ($(`.${page}:visible`).length) {
            $(`.${page}`).hide('slow');
        } else {
            pages.forEach(async (value) => {
                if (value === page) {
                    $(`.${value}`).show('slow');
                    $(element).addClass('active');
                    currentElement = element;
                    return;
                }
                $(`.${value}`).hide('slow');
            });
        }
    }
    
    $(document).ready(async () => {
        if (removeHomeClass)  $('a[href*="#home"]').parent().removeClass('active');
        
        $("form").submit(function (event) {
            event.preventDefault();
            var data = new FormData(this);
            var url = $(this).attr('action');
            var type = $(this).attr('method');
            
            $.ajax({
                url: url,
                type: type,
                contentType: false,
                processData: false,
                data: data,
                success: async (message) => {
                    await setrecaptcha();
                    $(".message-ajax").append(`
                        <div class="alert alert-${message.status === 'success' ? message.status : 'danger'}">
                            ${message.message}
                        </div>
                    `);
                    $(".message-ajax").show('slow');
                    setTimeout(async () => {
                        $(".message-ajax").hide('slow');
                    }, 3000);
                    setTimeout(async () => {
                        $(".message-ajax").empty();
                    }, 3300);
                },
                error: async (err) => {
                    await setrecaptcha();
                    $(".message-ajax").append(`
                        <div class="alert alert-danger">
                            ${err.responseJSON.message || err.statusText}
                        </div>
                    `);
                    $(".message-ajax").show('slow');
                    setTimeout(async () => {
                        $(".message-ajax").hide('slow');
                    }, 3000);
                    setTimeout(async () => {
                        $(".message-ajax").empty();
                    }, 3300);
                },
            });
        });

        async function getApi(url, classAppend) {
            $.ajax({
                url: url,
                success: async (data) => {
                    var appendData = '<div class="row"><table class="table table-dark table-hover table-striped">';
                    data.data.forEach(async (value, key) => {
                        var id = value.id;
                        delete value.id;
                        delete value.createdAt;
                        delete value.updatedAt;
                        if (typeof keys === 'undefined') {
                            var keys = Object.keys(value);
                            appendData += '<thead>';
                            keys.forEach(async (name) => {
                                appendData += `<th>${translate[name]}</th>`;
                            });
                            appendData += `<th colspan="2">Ação</th>`;
                            appendData += '</thead>';
                            appendData += '<tbody>';
                        }

                        keys.forEach(async (name) => {
                            appendData += `<td>${value[name]}</td>`;
                        });

                        appendData += `
                            <td>
                                <button class="btn btn-primary" onclick="updateApi('${url}', '${id}');">Alterar</button>
                            </td>
                            <td>
                                <button class="btn btn-danger" onclick="deleteApi('${url}', '${id}');">Deletar</button>
                            </td>
                        `;
                        appendData += '</tbody>';
                    });

                    appendData += '</table></div>';
                    
                    $(classAppend).append(appendData);
                },
                error: async (err) => {
                    $(classAppend).append('<div class="alert alert-danger">Houve algum problema na API!</div>');
                },
            });
        }

        
        <% if (user.access === 3) { %>

            translate.haha = 'teste';

            pages.push('donate-packages');
            pages.push('donate-items');

            await getApi('/donate-packages', '.list-donate-packages');

        <% } %>


    });*/
</script>
